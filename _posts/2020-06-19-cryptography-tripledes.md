---
layout: post
title: "TIL: Cryptography - Triple DES"
description: "Some learnings about Triple DES cipher"
comments: true
keywords: "Cryptography, Triple DES, AWS CloudHSM"
---
In this Today I Learned I would like to explain my learnings about the Triple DES cipher that I had to use in one of the projects at work. So it started with a requirement from the client we interface with to send over the data which is encrypted with a symmetric key they provided and the cipher being Triple DES double-length(two keys) key. And also the requirement is to store the key in a Hardware Security Module(HSM). Questions surrounding the strength of the cipher being asked to use aside, that looked pretty easy at the start, because the project is implemented in java, and java has pretty good cryptography APIs packaged as Java Cryptography Extension(JCE). And second there is an HSM already in place, all it needed was to load the key, and using the JCE implementation of the HSM provider, start encrypting. But, here I hit the road block, the HSM(AWS CloudHSM) that we use doesn't support a double-length key. When I found out that, being naive, I said it is not possible to load the key into HSM. However, after a meeting with one of our colleague explaning our use case, got to know a work around that they had to do to a similar problem. So I went back and started reading the theory of Triple DES cipher, and that was a good learning as it helped to clear the road block. Just to give a primer on Triple DES cipher, it is three consecutive(encrypt-decrypt-encrypt) single DES operations done with three keys`(K1, K2, K3)`, a key for each round. In a double-length Triple DES encryption, the first and last round's key is same - `Encrypt(K1) - Decrypt(K2) - Encrypt(K1)`. This struck my mind on how to import the key into HSM - just append the first key to the last; this makes it a triple-length key, and it can be loaded into the HSM. And when we do Triple DES using this key, it is equal to a double-length Triple DES. Done, this solved our problem. This might be reason AWS CloudHSM supports only triple-length Triple DES keys, and it's upto the clients to apply the workarounds. As a curiosity if we want to have backward compatibility to perform regular DES using Triple DES, guess, have to create a triple-length key where `K1 = K2 = K3`. However, with this, as you notice, there is a unnecessary computation done here because rounds two and three are redundant.